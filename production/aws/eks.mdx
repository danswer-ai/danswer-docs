---
title: "EKS"
description: "This guide provides instructions for setting up EKS and installing Danswer on the EKS infrastructure."
---

## Prerequisites

- [AWS CLI](https://aws.amazon.com/cli/) (required for creating and accessing the cluster)
- [kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/) (for cluster access through the CLI)
- [Helm](https://helm.sh/docs/intro/install/) (for installing Danswer using Helm charts)

## Cluster Setup and Configuration

### Create the Cluster

1. Navigate to Elastic Kubernetes Service (EKS) and create a new cluster.
2. For `Cluster service role`, create a new IAM role accepting all the defaults.
3. Select a `Kubernetes version` with standard support and set `Upgrade policy` to `Standard`.
4. Accept the remaining defaults and create the cluster.

### Add Worker Nodes

1. When the cluster is Active, select the `Compute` tab and then `Add node group`.
2. Provide a `Name` for the group and create a new IAM role for this node group.
3. Set `Instance Types` to `c4.2xlarge` and accept the remaining defaults.
4. Create the node group (this may take up to 15 minutes).

### Create and Connect a User

1. In the IAM Dashboard, create a new user with the following permissions:
   - `AmazonEKSClusterPolicy`
   - `AmazonEKSServicePolicy`
2. Create an access key for this user, selecting the CLI option.
3. In the EKS cluster, create an access entry for this user with the `AmazonEKSClusterAdminPolicy`.

## Fetch the kubeconfig File

1. Log into AWS CLI:
   ```shell
   aws configure
   ```
2. Update kubeconfig:
   ```shell
   aws eks update-kubeconfig --region <region-code> --name <cluster-name>
   ```

## Install Danswer Services

### Option 1: Using Kubernetes Configurations

[Unchanged content for Option 1]

### Option 2: Using Helm Charts

1. Install Helm if you haven't already:
   ```shell
   curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
   ```

2. Install the EBS CSI driver:
   ```shell
   helm repo add aws-ebs-csi-driver https://kubernetes-sigs.github.io/aws-ebs-csi-driver
   helm repo update
   helm upgrade --install aws-ebs-csi-driver aws-ebs-csi-driver/aws-ebs-csi-driver \
       --namespace kube-system \
       --set controller.serviceAccount.create=true \
       --set controller.serviceAccount.name=ebs-csi-controller-sa
   ```

3. Configure IAM permissions for the EBS CSI driver:
   - Create a new IAM policy with the necessary permissions for EBS operations.
   - Attach the policy to the IAM role associated with your EKS node group.
   - Also attach the AWS-managed policy for EBS CSI driver:
     ```shell
     aws iam attach-role-policy --role-name <your-node-group-role> --policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy
     ```

4. Create an EBS StorageClass:
   ```yaml
   apiVersion: storage.k8s.io/v1
   kind: StorageClass
   metadata:
     name: ebs-sc
   provisioner: ebs.csi.aws.com
   volumeBindingMode: WaitForFirstConsumer
   parameters:
     type: gp3
   ```
   Apply this StorageClass: `kubectl apply -f ebs-storageclass.yaml`

5. Navigate to the directory containing the Helm charts:
   ```shell
   cd path/to/danswer/deployment/helm
   ```

6. Create a namespace for Danswer:
   ```shell
   kubectl create namespace danswer
   ```

7. Install Danswer using Helm:
   ```shell
   helm install danswer . --namespace danswer
   ```

8. Wait for all pods to be in the "Running" state:
   ```shell
   kubectl get pods -n danswer --watch
   ```

9. Get the external IP or hostname of the Danswer service:
   ```shell
   kubectl get svc -n danswer danswer-nginx -o jsonpath='{.status.loadBalancer.ingress[0].hostname}'
   ```

Navigate to the URL or IP address provided to access your Danswer installation.